# Room Classification Backend API

This Flask backend provides an API for classifying room types (kitchen, bedroom, bathroom, living room) from images using a PyTorch ResNet18 model.

## Setup

1. **Install Python dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

2. **Ensure the model file exists:**
   - The model file `room_classifier.pt` should be in the parent directory (root of the project)
   - This file is generated by running `train_room_classifier.py`

3. **Run the server:**
   ```bash
   python app.py
   ```

   The server will start on `http://localhost:5000`

## API Endpoints

### Health Check
```
GET /health
```
Returns server health status and whether the model is loaded.

**Response:**
```json
{
  "status": "healthy",
  "model_loaded": true
}
```

### Predict Room Type
```
POST /predict
```
Classifies an uploaded image and returns the predicted room type and confidence score.

**Request:**
- Content-Type: `multipart/form-data`
- Field name: `image`
- File types: `png`, `jpg`, `jpeg`, `gif`, `webp`
- Max file size: 16MB

**Response:**
```json
{
  "prediction": "kitchen",
  "confidence": 0.95
}
```

**Possible room types:**
- `bathroom`
- `bedroom`
- `kitchen`
- `living_room`

## Flutter Integration

### Configuration

Update the `baseUrl` in `tenantguard/lib/core/services/room_classification_service.dart`:

- **Android Emulator**: `http://10.0.2.2:5000`
- **iOS Simulator**: `http://localhost:5000`
- **Physical Device**: `http://<your-computer-ip>:5000` (ensure both devices are on the same network)

To find your computer's IP address:
- Windows: `ipconfig` in Command Prompt
- Mac/Linux: `ifconfig` in Terminal

### Testing

1. Start the Flask backend:
   ```bash
   cd backend
   python app.py
   ```

2. Test the health endpoint:
   ```bash
   curl http://localhost:5000/health
   ```

3. Test the prediction endpoint:
   ```bash
   curl -X POST -F "image=@path/to/image.jpg" http://localhost:5000/predict
   ```

## Troubleshooting

- **Model not found**: Ensure `room_classifier.pt` exists in the project root
- **CORS errors**: The Flask app includes CORS middleware, but ensure the Flutter app is using the correct backend URL
- **Connection refused**: Make sure the backend is running and accessible from your device/emulator
- **Slow predictions**: First prediction may take longer as the model loads into memory

